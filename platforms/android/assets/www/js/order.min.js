function checkOrder(e){var t='<span style="position: absolute; right: 5px; top:5px;"><img src="images/check.png" id="remove" alt="" style="width:16px"></span>';return"Completed"==e?t:""}function ioCheck(e){return e==localStorage.getItem("obe_sessionID")?"outgoing":"incoming"}$("#add-order .product-list input").each(function(){$(this).on("blur",function(){var e=0;$("#add-order .product-list input").each(function(){""!=$(this).val()&&(e+=parseInt($(this).val())),$("#add-order input[name=total_product]").val(e)})})}),$("#add-order .marketing-list input").each(function(){$(this).on("blur",function(){var e=0;$("#add-order .marketing-list input").each(function(){""!=$(this).val()&&(e+=parseInt($(this).val())),$("#add-order input[name=total_marketing]").val(e)})})}),$("#add-order .order-now").on("click",function(){if("Name, address, phone number and note"==$("textarea[name=order_desc]").val()||0==$("#add-order input[name=total_product]").val()&&0==$("#add-order input[name=total_marketing]").val())alert("Please complete order form.");else{var e="POST";if(1==confirm("Place order?")){var t=[];$("#add-order li a").each(function(){var e=$(this).attr("data-item"),i=$(this).attr("data-type"),a=$(this).find("input").val();item={},item.product_id=e,item.type=i,item.quantity=a,0!=a&&t.push(item)}),localStorage.setItem("obe_sessionORDERITEMS",JSON.stringify(t)),$.get(api+"GO_ORDER_CONTROLLER.php?action=order",{agent_id:localStorage.getItem("obe_sessionID"),stockist_id:localStorage.getItem("obe_sessionSTOCKISTID"),order_detail:t,total_quantity:$("input[name=total_product]").val(),note:$("textarea[name=order_desc]").val()},function(t){"POST"==e&&t>0?(localStorage.setItem("obe_sessionORDERID",t),alert("Order sent"),$.mobile.navigate("#profile"),location.reload()):alert("We are having difficulties processing your order.\nPlease try again.")})}}});var new_count=0,complete_count=0;$.get(api+"GO_ORDER_CONTROLLER.php?action=agent_order_history&obe_id="+localStorage.getItem("obe_sessionID"),function(e){for($("#profile .outgoing-order").html(""),$("#outgoing-order .outgoing-order").html(""),$("#show-new .new-order").html(""),$("#show-complete .complete-order").html(""),$("#show-total .total-order").html(""),e=JSON.parse(e),console.log(e),i=0;i<e.length;i++)if(null!=e[i].order_status){"New"==e[i].order_status&&(new_count++,$(".new-count").html(new_count),$(".total-count").html(new_count+complete_count)),"Completed"==e[i].order_status&&(complete_count++,$(".complete-count").html(complete_count),$(".total-count").html(new_count+complete_count));var t=0,a=0,r=JSON.parse(e[i].order_detail);$.each(r,function(e,i){"product"==i.type?t+=parseInt(i.quantity):"marketing"==i.type&&(a+=parseInt(i.quantity))});var o=e[i].order_date.split("/"),n=(o[2].split(""),'<li style="position:relative">'+checkOrder(e[i].status)+'<a href="#order-detail" data-order-id='+e[i].order_id+'><span class="day_name">'+o[0]+"/"+o[1]+"/"+o[2][2]+o[2][3]+"</span>&nbsp; "+e[i].order_time+' <label class="digits"> '+e[i].user_name+' </label><div class="clear"></div></a></li>');if(5>i&&"New"==e[i].status&&$("#profile .outgoing-order").append(n),$("#outgoing-order .outgoing-order").append(n),"New"==e[i].status){var d='<li><a href="#order-detail" style="position: relative;" data-order-id="'+e[i].order_id+'"><span class="day_name">'+o[0]+"/"+o[1]+"/"+o[2][2]+o[2][3]+"</span>&nbsp; "+e[i].order_time+' <label class="digits"> '+e[i].user_name+' </label><div class="clear"></div><div id="box-'+ioCheck(e[i].agent_id)+'"></div></a> </li>';$("#show-new .new-order").append(d)}if("Completed"==e[i].status){var d='<li><a href="#order-detail" style="position: relative;" data-order-id="'+e[i].order_id+'"><span class="day_name">'+o[0]+"/"+o[1]+"/"+o[2][2]+o[2][3]+"</span>&nbsp; "+e[i].order_time+' <label class="digits"> '+e[i].user_name+' </label><div class="clear"></div><div id="box-'+ioCheck(e[i].agent_id)+'"></div></a> </li>';$("#show-complete .complete-order").append(d)}if("New"==e[i].status||"Completed"==e[i].status){var d='<li><a href="#order-detail" style="position: relative;" data-order-id="'+e[i].order_id+'"><span class="day_name">'+o[0]+"/"+o[1]+"/"+o[2][2]+o[2][3]+"</span>&nbsp; "+e[i].order_time+' <label class="digits"> '+e[i].user_name+' </label><div class="clear"></div><div id="box-'+ioCheck(e[i].agent_id)+'"></div></a> </li>';$("#show-total .total-order").append(d)}}$("[href=#order-detail]").each(function(){$(this).bind("click",function(){var t=$(this).attr("data-order-id");for(localStorage.setItem("obe_sessionCURRENTORDER",t),i=0;i<e.length;i++)if(e[i].order_id==t){var a=e[i].order_date.split("/"),r=0,o=0,l=JSON.parse(e[i].order_detail);$.each(l,function(e,t){"product"==t.type?r+=parseInt(t.quantity):"marketing"==t.type&&(o+=parseInt(t.quantity))}),$(".agent_name").html(e[i].user_name),$(".username").html(e[i].user_callsign),$(".date_order").html(a[0]+"/"+a[1]+"/"+a[2][2]+a[2][3]+"&nbsp;"),$(".time_order").html(e[i].order_time),$(".p-quantity_order").html(r+"pcs"),$(".m-quantity_order").html(o+"pcs"),$(".status-badge").html(e[i].status),$(".order_note").html(e[i].note),"Completed"==e[i].status?($(".status-badge").css("background","#11a8ab"),$(".id_order").html(e[i].order_id+"&nbsp;"),$("#order-detail .order-detail").append('<li class="complete-date"><a href="#"><span>Completed Date</span> <label class="complete_on">'+e[i].clear_date+'</label><div class="clear"></div></a> </li>'),$("#order-detail .signin_facebook").hide()):"New"==e[i].status&&($(".id_order").html(e[i].order_id+"&nbsp;"),$(".status-badge").css("background","#e64c65"),$(".complete-date").hide(),$("#order-detail .signin_facebook").show()),"Agent"==localStorage.obe_sessionROLE&&$("#order-detail .signin_facebook").hide()}})}),$("[href=#quantity-break]").each(function(){$(this).bind("click",function(){var t=$(this).find("label").attr("class");if("p-quantity_order"==t){for($("#quantity-break .quantity-title").html("Product Order Details"),$("#quantity-break .order-detail label.p-quantity_order").show(),$("#quantity-break .order-detail label.m-quantity_order").hide(),$("#quantity-break .product-list-order").show(),$("#quantity-break .marketing-list-order").hide(),$(".product-list-order").html(""),i=0;i<e.length;i++)if(e[i].agent_id==localStorage.getItem("obe_sessionID")&&e[i].order_id==localStorage.getItem("obe_sessionCURRENTORDER")){var a=e[i].order_detail;a=JSON.parse(a),$.each(a,function(e,t){if("product"==t.type){var i='<li> <a href="#" data-item="'+t.product_id+'" data-type="product"> <table style="width: 100%"> <tr> <td style="width: 35%;padding:0;"><img src="images/fleur/'+t.product_id+'.jpeg" style="width: 80px;height: 80px;border: 3px solid #50597b;border-radius: 50%;"></td> <td style="width:65%;padding:0 0 0 10px;vertical-align:top;color:#fff;"> <p style="font-size: 1.3em;text-transform:capitalize">'+t.product_id.split("-").join(" ")+'</p> <p><span class="product-order" style="margin: 0;position: absolute;width: 50%;"> <input type="number" name="order_quantity" value="'+t.quantity+'" style="width:65%;padding:3px 10px;text-align: right;" disabled><i>pcs</i> </span> </p> </td> </tr> </table> <div class="clear"></div> </a> </li>';$(".product-list-order").append(i)}})}}else if("m-quantity_order"==t)for($("#quantity-break .quantity-title").html("Marketing Order Details"),$("#quantity-break .order-detail label.m-quantity_order").show(),$("#quantity-break .order-detail label.p-quantity_order").hide(),$("#quantity-break .marketing-list-order").show(),$("#quantity-break .product-list-order").hide(),$(".marketing-list-order").html(""),i=0;i<e.length;i++)if(e[i].agent_id==localStorage.getItem("obe_sessionID")&&e[i].order_id==localStorage.getItem("obe_sessionCURRENTORDER")){var a=e[i].order_detail;a=JSON.parse(a),$.each(a,function(e,t){if("marketing"==t.type){var i='<li> <a href="#" data-item="'+t.product_id+'" data-type="product"> <table style="width: 100%"> <tr> <td style="width: 35%;padding:0;"><img src="images/marketing/'+t.product_id+'.jpeg" style="width: 80px;height: 80px;border: 3px solid #50597b;border-radius: 50%;"></td> <td style="width:65%;padding:0 0 0 10px;vertical-align:top;color:#fff;"> <p style="font-size: 1.3em;text-transform:capitalize">'+t.product_id.split("-").join(" ")+'</p> <p><span class="product-order" style="margin: 0;position: absolute;width: 50%;"> <input type="number" name="order_quantity" value="'+t.quantity+'" style="width:65%;padding:3px 10px;text-align: right;" disabled><i>pcs</i> </span> </p> </td> </tr> </table> <div class="clear"></div> </a> </li>';$(".marketing-list-order").append(i)}})}})})}),$.get(api+"GO_ORDER_CONTROLLER.php?action=stockist_order_history&obe_id="+localStorage.getItem("obe_sessionID"),function(e){for($("#profile .incoming-order").html(""),$("#incoming-order .incoming-order").html(""),$("#show-new .new-order").html(""),$("#show-complete .complete-order").html(""),$("#show-total .total-order").html(""),e=JSON.parse(e),console.log(e),i=0;i<e.length;i++)if(null!=e[i].order_status){"New"==e[i].order_status&&(new_count++,$(".new-count").html(new_count),$(".total-count").html(new_count+complete_count)),"Completed"==e[i].order_status&&(complete_count++,$(".complete-count").html(complete_count),$(".total-count").html(new_count+complete_count));var t=0,a=0,r=JSON.parse(e[i].order_detail);$.each(r,function(e,i){"product"==i.type?t+=parseInt(i.quantity):"marketing"==i.type&&(a+=parseInt(i.quantity))});var o=e[i].order_date.split("/"),l='<li style="position:relative">'+checkOrder(e[i].status)+'<a href="#order-detail" data-order-id="'+e[i].order_id+'"><span class="day_name">'+o[0]+"/"+o[1]+"/"+o[2][2]+o[2][3]+"</span>&nbsp; "+e[i].order_time+' <label class="digits"> '+e[i].user_name+' </label><div class="clear"></div></a></li>';if(5>i&&"New"==e[i].status&&$("#profile ul.incoming-order").append(l),$("#incoming-order .incoming-order").append(l),"New"==e[i].status){var n='<li><a href="#order-detail" style="position: relative;" data-order-id="'+e[i].order_id+'"><span class="day_name">'+o[0]+"/"+o[1]+"/"+o[2][2]+o[2][3]+"</span>&nbsp; "+e[i].order_time+' <label class="digits"> '+e[i].user_name+' </label><div class="clear"></div><div id="box-'+ioCheck(e[i].agent_id)+'"></div></a> </li>';$("#show-new .new-order").append(n)}if("Completed"==e[i].status){var n='<li><a href="#order-detail" style="position: relative;" data-order-id="'+e[i].order_id+'"><span class="day_name">'+o[0]+"/"+o[1]+"/"+o[2][2]+o[2][3]+"</span>&nbsp; "+e[i].order_time+' <label class="digits"> '+e[i].user_name+' </label><div class="clear"></div><div id="box-'+ioCheck(e[i].agent_id)+'"></div></a> </li>';$("#show-complete .complete-order").append(n)}if("New"==e[i].status||"Completed"==e[i].status){var n='<li><a href="#order-detail" style="position: relative;" data-order-id="'+e[i].order_id+'"><span class="day_name">'+o[0]+"/"+o[1]+"/"+o[2][2]+o[2][3]+"</span>&nbsp; "+e[i].order_time+' <label class="digits"> '+e[i].user_name+' </label><div class="clear"></div><div id="box-'+ioCheck(e[i].agent_id)+'"></div></a> </li>';$("#show-total .total-order").append(n)}}$("[href=#order-detail]").each(function(){$(this).bind("click",function(){var t=$(this).attr("data-order-id");for(localStorage.setItem("obe_sessionCURRENTORDER",t),i=0;i<e.length;i++)if(e[i].order_id==t){var a=e[i].order_date.split("/"),r=0,o=0,l=JSON.parse(e[i].order_detail);$.each(l,function(e,t){"product"==t.type?r+=parseInt(t.quantity):"marketing"==t.type&&(o+=parseInt(t.quantity))}),$(".agent_name").html(e[i].user_name),$(".username").html(e[i].user_callsign),$(".date_order").html(a[0]+"/"+a[1]+"/"+a[2][2]+a[2][3]+"&nbsp;"),$(".time_order").html(e[i].order_time),$(".p-quantity_order").html(r+"pcs"),$(".m-quantity_order").html(o+"pcs"),$(".status-badge").html(e[i].status),$(".order_note").html(e[i].note),"Completed"==e[i].status?($("#order-detail .complete-wrapper").show(),$(".status-badge").css("background","#11a8ab"),$(".id_order").html(e[i].order_id+"&nbsp;"),$("#order-detail .complete-wrapper .complete_on").html(e[i].clear_date),$("#order-detail .signin_facebook").hide()):"New"==e[i].status&&($(".id_order").html(e[i].order_id+"&nbsp;"),$(".status-badge").css("background","#e64c65"),$("#order-detail .complete-wrapper").hide(),$("#order-detail .signin_facebook").show())}})}),$("[href=#quantity-break]").each(function(){$(this).bind("click",function(){var t=$(this).find("label").attr("class");if("p-quantity_order"==t){for($("#quantity-break .quantity-title").html("Product Order Details"),$("#quantity-break .order-detail label.p-quantity_order").show(),$("#quantity-break .order-detail label.m-quantity_order").hide(),$("#quantity-break .product-list-order").show(),$("#quantity-break .marketing-list-order").hide(),$(".product-list-order").html(""),i=0;i<e.length;i++)if(e[i].stockist_id==localStorage.getItem("obe_sessionID")&&e[i].order_id==localStorage.getItem("obe_sessionCURRENTORDER")){var a=e[i].order_detail;a=JSON.parse(a),$.each(a,function(e,t){if("product"==t.type){var i='<li> <a href="#" data-item="'+t.product_id+'" data-type="product"> <table style="width: 100%"> <tr> <td style="width: 35%;padding:0;"><img src="images/fleur/'+t.product_id+'.jpeg" style="width: 80px;height: 80px;border: 3px solid #50597b;border-radius: 50%;"></td> <td style="width:65%;padding:0 0 0 10px;vertical-align:top;color:#fff;"> <p style="font-size: 1.3em;text-transform:capitalize">'+t.product_id.split("-").join(" ")+'</p> <p><span class="product-order" style="margin: 0;position: absolute;width: 50%;"> <input type="number" name="order_quantity" value="'+t.quantity+'" style="width:65%;padding:3px 10px;text-align: right;" disabled><i>pcs</i> </span> </p> </td> </tr> </table> <div class="clear"></div> </a> </li>';$(".product-list-order").append(i)}})}}else if("m-quantity_order"==t)for($("#quantity-break .quantity-title").html("Marketing Order Details"),$("#quantity-break .order-detail label.m-quantity_order").show(),$("#quantity-break .order-detail label.p-quantity_order").hide(),$("#quantity-break .marketing-list-order").show(),$("#quantity-break .product-list-order").hide(),$(".marketing-list-order").html(""),i=0;i<e.length;i++)if(e[i].stockist_id==localStorage.getItem("obe_sessionID")&&e[i].order_id==localStorage.getItem("obe_sessionCURRENTORDER")){var a=e[i].order_detail;a=JSON.parse(a),$.each(a,function(e,t){if("marketing"==t.type){var i='<li> <a href="#" data-item="'+t.product_id+'" data-type="product"> <table style="width: 100%"> <tr> <td style="width: 35%;padding:0;"><img src="images/marketing/'+t.product_id+'.jpeg" style="width: 80px;height: 80px;border: 3px solid #50597b;border-radius: 50%;"></td> <td style="width:65%;padding:0 0 0 10px;vertical-align:top;color:#fff;"> <p style="font-size: 1.3em;text-transform:capitalize">'+t.product_id.split("-").join(" ")+'</p> <p><span class="product-order" style="margin: 0;position: absolute;width: 50%;"> <input type="number" name="order_quantity" value="'+t.quantity+'" style="width:65%;padding:3px 10px;text-align: right;" disabled><i>pcs</i> </span> </p> </td> </tr> </table> <div class="clear"></div> </a> </li>';$(".marketing-list-order").append(i)}})}})})}),$(".complete-now").on("click",function(){confirm("Complete order?")&&($("#preloader").show(),$.get(api+"GO_ORDER_CONTROLLER.php?action=complete&order_id="+localStorage.getItem("obe_sessionCURRENTORDER"),function(e){console.log(e),1==e&&($("#preloader").delay(1e3).fadeOut("slow").hide(),alert("Order Completed"))}))});